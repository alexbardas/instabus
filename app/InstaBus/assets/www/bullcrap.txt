
<!DOCTYPE html> 
<html> 
	<head> 
	<title>Transport Urban</title>
    <link rel="shortcut icon" href="/img/favicon.ico" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript">
	
//window.addEventListener("orientationchange", checkOrientation, false);
//window.addEventListener("resize", checkOrientation, false);
//var mapH = 0;

function checkOrientation() {
	//alert('orientation');
	var currentPage = $.mobile.activePage.attr('id');
	
	
	$('#dummy').show();
	if (currentPage == 'page-map') {
		scroll(0, 1);
	}
	
	var element = document.getElementById('map');
	//if (mapH == 0) {
		var tempH = window.innerHeight - $('div[data-role="header"]').height();
		element.style.height = tempH + 'px';
	//} else {
		//element.style.height = mapH + 'px';
	//}
	
	//if (window.pageYOffset == 1) {
		$('#dummy').hide();
		//mapH = tempH;
	//}
	
	//google.maps.event.trigger(map, 'resize');
}

var fixgeometry = function() {
    /* Some orientation changes leave the scroll position at something
     * that isn't 0,0. This is annoying for user experience. */
    scroll(0, 0);

    /* Calculate the geometry that our content area should take */
    var header = $(".header:visible");
    var footer = $(".footer:visible");
    var content = $(".content:visible");
    var viewport_height = $(window).height();
    
    var content_height = viewport_height - header.outerHeight() - footer.outerHeight();
    
    /* Trim margin/border/padding height */
    content_height -= (content.outerHeight() - content.height());
    content.height(content_height);
	$("#map").height(content_height);
  }; /* fixgeometry */
  
  function onPageChange() {
	  checkOrientation();
	  google.maps.event.trigger(map, 'resize');
  }

  $(document).ready(function() {
	  checkOrientation();
    $(window).bind("orientationchange resize", checkOrientation);
	
	$(window).bind("pagechange", onPageChange);
	
	//detect redirect
	var redirect = $('#redirect').val();
	if (redirect == 'true') {
		//alert('redirect');
		$.mobile.changePage('#dialog-redirect', {transition: 'pop', role: 'dialog'});
	}
  });

var initialLocation;
var siberia = new google.maps.LatLng(60, 105);
var newyork = new google.maps.LatLng(40.69847032728747, -73.9514422416687);
var bucharest = new google.maps.LatLng(44.4332, 26.0913);
var browserSupportFlag =  new Boolean();

function initialize_mobile() {
	//
	//var element = document.getElementById('map');
	//element.width = screen.width;
	//element.style.height = window.outerHeight+'px';
	//window.location.hash = "map";
	//document.getElementById('map').scrollTop = document.getElementById('map').offsetTop;
	//alert (screen.availHeight);
	//alert(window.innerHeight);
	//alert(window.innerHeight);
	//alert(window.outerHeight);
	

  var myOptions = {
    zoom: 15,
	streetViewControl: false,
	mapTypeControl: false,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  var map = new google.maps.Map(document.getElementById("map"), myOptions);
  
  // Try W3C Geolocation (Preferred)
  if(navigator.geolocation) {
    browserSupportFlag = true;
    navigator.geolocation.getCurrentPosition(function(position) {
      initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
      map.setCenter(initialLocation);
    }, function() {
      handleNoGeolocation(browserSupportFlag);
    });
  // Try Google Gears Geolocation
  } else if (google.gears) {
    browserSupportFlag = true;
    var geo = google.gears.factory.create('beta.geolocation');
    geo.getCurrentPosition(function(position) {
      initialLocation = new google.maps.LatLng(position.latitude,position.longitude);
      map.setCenter(initialLocation);
    }, function() {
      handleNoGeoLocation(browserSupportFlag);
    });
  // Browser doesn't support Geolocation
  } else {
    browserSupportFlag = false;
    handleNoGeolocation(browserSupportFlag);
  }
  
  function handleNoGeolocation(errorFlag) {
    if (errorFlag == true) {
      alert("Geolocation service failed.");
      initialLocation = bucharest;
    } else {
      alert("Your browser doesn't support geolocation. We've placed you in Siberia.");
      initialLocation = bucharest;
    }
    map.setCenter(initialLocation);
  }
  
  //checkOrientation();
  
}
</script>
<style type="text/css">
html, body, #page-map, #page-map .ui-content, #map { padding: 0; } 
html, body { width: 100%; height: 100%; } 
/*#map { height: min-height: 100%; }(/
/*#map { width: 100%; height: 100%; }*/

</style>
</head> 
<body onload="initialize_mobile();"> 

	<!--<div id="dummy" style="height: 1000px;"></div>-->
    
    
	<div data-role="page" id="page-map">
    	<!--<div class="ui-bar ui-bar-a">
        	<a href="#" data-icon="grid" data-role="button" data-iconpos="notext">Traseu</a>
            <a href="#" data-icon="search" data-role="button" data-iconpos="notext">Search</a>
            <h1>Transport Urban</h1>
        </div>-->
        <div data-role="header">
        	<a href="#page-route" data-icon="grid" data-role="button">Traseu</a>
            
            <h1>Transport Urban</h1>
            <a href="#page-settings" data-icon="gear" class="ui-btn-right" data-iconpos="notext">Setari</a>
        </div><!-- /header -->
        
        <div data-role="content">
            <div id="map"></div>
        </div>
    </div>
    
    <div data-role="page" id="page-settings">
    	<div data-role="header">
        	<a href="#page-map" data-icon="back" class="ui-btn-left">Inapoi</a>
        	<h1>Setari</h1>
        </div>
        
        <div data-role="content">
        	Optiuni avansate traseu:
            <fieldset data-role="controlgroup">
                    <input type="radio" name="tip_traseu" id="traseu_rapid" value="1" checked="checked" />
                    <label for="traseu_rapid">traseu rapid</label>
        
                    <input type="radio" name="tip_traseu" id="traseu_direct" value="0" />
                    <label for="traseu_direct">traseu rapid</label>
            </fieldset>
            
            Rute speciale:
            <fieldset data-role="controlgroup">
                <input type="checkbox" name="rto" id="rto" class="custom" />
                <label for="rto">rute aeroport Otopeni</label>
    
                <input type="checkbox" name="rtp" id="rtp" class="custom" />
                <label for="rtp">rute in afara Bucurestiului</label>
            </fieldset>
        
        	<label for="slider-0">Complexitate cautare:</label>
   			<input type="range" name="slider" id="slider-0" value="3" min="1" max="5"  />
        </div>
    </div>
    
    <div data-role="page" id="page-route">
    	<div data-role="header">
        	<a href="#page-map" data-icon="back" class="ui-btn-left">Inapoi</a>
        	<h1>Traseu</h1>
        </div>
        
        <div data-role="content">
            <input type="search" name="search" value="" />
            
            <br />
            
                <fieldset data-role="controlgroup">
                        <input type="radio" name="radio-choice-1" id="radio-choice-1" value="choice-1" checked="checked" />
                        <label for="radio-choice-1">traseu zi</label>
            
                        <input type="radio" name="radio-choice-1" id="radio-choice-2" value="choice-2" />
                        <label for="radio-choice-2">traseu noapte</label>
                </fieldset>

                <fieldset data-role="controlgroup">
                        <input type="checkbox" name="ch1" id="ch1" value="a" checked="checked" class="custom" style="width: 32%;" />
                        <label for="ch1">metrou</label>
            
                        <input type="checkbox" name="ch2" id="ch2" value="b" checked="checked" class="custom" style="width: 32%;" />
                        <label for="ch2">tramvai</label>
                        
                        <input type="checkbox" name="ch3" id="ch3" value="c" checked="checked" class="custom" style="width: 32%;" />
                        <label for="ch3">autobuz / troleibuz</label>
                </fieldset>

            

                <p><a href="#" data-role="button">Plecare</a>
                <a href="#" data-role="button">Sosire</a></p>
                
                <p><a href="#" data-role="button" data-theme="b">Calculeaza ruta</a></p>
                        
            
            
            <!--<div data-role="controlgroup" data-type="horizontal" id="transport-type" align="center">
                <a href="#" data-role="button" style="width: 32%;">a</a>
                <a href="#" data-role="button" style="width: 32%;">b</a>
                <a href="#" data-role="button" style="width: 32%;">c</a>
            </div>-->
            
            
        </div>
    </div>
    
    <div data-role="dialog" id="dialog-redirect">
    	<div data-role="header">
        	<h1>Redirectionare</h1>
        </div>
        <div data-role="content">
        	Ati fost redirectionat automat catre varianta web mobila a aplicatiei.
            
            <a href="#page-map" data-role="button" data-theme="b">Ok</a>       
			<a href="http://www.transporturban.ro/?noredirect=true" rel="external" data-role="button" data-theme="c">Varianta desktop</a> 
        </div>
    </div>

</body>
</html>